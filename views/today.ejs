<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ðŸŒ¿ ExTodo â€” Today</title>

  <style>
    :root{
      --brand-dark:#2c3e50;
      --accent:#e74c3c;
      --bg:#f9f9f9;
      --card:#fff;
      --text:#333;
      --muted:#888;
      --shadow-md: 0 4px 8px rgba(0,0,0,0.06);
      --shadow-lg: 0 8px 20px rgba(0,0,0,0.09);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    html,body{height:100%}
    body{
      background:var(--bg);
      color:var(--text);
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }

    /* page layout (keeps sidebar + content columns) */
    .layout{
      display:flex;
      gap:0;
      flex:1;
      align-items:stretch;
      min-height: calc(100vh - 60px); /* leave space for navbar if any */
    }

    /* If your sidebar partial has its own styles, these only ensure spacing */
    .sidebar {
      width: 240px;
      background: transparent; /* actual sidebar partial styles will apply */
      padding: 1rem 1rem;
      border-right: 1px solid #eee;
    }

    .content{
      flex:1;
      padding: 24px 32px;
      overflow-y:auto;
    }

    .page-title{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:18px;
    }
    .page-title h1{
      font-size:28px;
      color:var(--brand-dark);
      font-weight:700;
    }

    .todo-list-container{
      max-width:880px;
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .todo-card{
      background:var(--card);
      padding:14px 16px;
      border-radius:10px;
      box-shadow:var(--shadow-md);
      border:1px solid rgba(0,0,0,0.03);
      transition:box-shadow .18s ease, transform .12s ease;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .todo-card:hover{ box-shadow:var(--shadow-lg); transform:translateY(-3px); }

    .todo-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }

    .todo-text{
      font-size:16px;
      font-weight:600;
      color:var(--brand-dark);
      word-break:break-word;
    }

    .todo-actions{ display:flex; gap:8px; align-items:center; }

    .done-btn{
      background: #2ecc71;
      color:#fff;
      border:none;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
    }
    .done-btn:hover{ background:#27ae60; }

    .todo-meta{
      display:flex;
      justify-content:space-between;
      gap:12px;
      color:var(--muted);
      font-size:0.9rem;
      align-items:center;
    }

    .priority {
      display:inline-block;
      padding:4px 8px;
      border-radius:999px;
      font-size:0.85rem;
      font-weight:600;
    }
    .priority.high{ background:#ffecec; color:#e74c3c; }
    .priority.medium{ background:#fff4e6; color:#f39c12; }
    .priority.low{ background:#ecffef; color:#22c55e; }

    .empty-message{
      text-align:center;
      color:var(--muted);
      padding:40px 0;
      font-size:1.05rem;
    }

    /* small screens */
    @media (max-width:900px){
      .sidebar{ display:none; }
      .content{ padding:16px; }
      .todo-list-container{ max-width:100%; }
    }
  </style>
</head>
<body>

  <!-- navbar partial -->
  <%- include("navbar", { username }) %>

  <div class="layout">
    <% if (username !== "guest") { %>
      <div class="sidebar"><%- include("sidebar") %></div>
    <% } %>

    <main class="content">
      <div class="page-title">
        <h1>ðŸ“… Today</h1>
        <div style="color:var(--muted);font-size:0.95rem;">
          <% if (tasks && tasks.length) { %>
            <span><%= tasks.length %> task<%= tasks.length>1 ? 's' : '' %></span>
          <% } %>
        </div>
      </div>

      <div class="todo-list-container">
        <% if (!tasks || tasks.length === 0) { %>
          <div class="empty-message">No tasks for today â€” enjoy a productive day ðŸŽ‰</div>
        <% } else { %>
          <% tasks.forEach(todo => { %>
            <div class="todo-card">
              <div class="todo-top">
                <div class="todo-text"><%= todo.text %></div>

                <div class="todo-actions">
                  <form action="/home/toggle" method="POST" style="display:inline;">
                    <input type="hidden" name="username" value="<%= username %>">
                    <input type="hidden" name="taskId" value="<%= todo.id %>">
                    <button type="submit" class="done-btn" title="Mark done">âœ”</button>
                  </form>
                </div>
              </div>

              <div class="todo-meta">
                <div>
                  <% if (todo.deadline) { %>
                    Due: <strong><%= new Date(todo.deadline).toLocaleDateString() %></strong>
                  <% } else { %>
                    No due date
                  <% } %>
                </div>
                <div>
                  <span class="priority <%= (todo.priority||'Medium').toLowerCase() %>">
                    ðŸš© <%= todo.priority || "Medium" %>
                  </span>
                </div>
              </div>
            </div>
          <% }) %>
        <% } %>
      </div>
    </main>
  </div>

  <!-- footer partial -->
  <%- include("footer") %>
</body>
</html>
