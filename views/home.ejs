<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üåø ExTodo - Smart Task Management</title>

  <style>
    :root {
      --brand-dark: #2c3e50;
      --accent: #e74c3c;
      --bg: #f9f9f9;
      --card: #fff;
      --text: #333;
      --light: #888;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { background: var(--bg); color: var(--text); display: flex; flex-direction: column; height: 100vh; }
    .layout { flex: 1; display: flex; }

    /* Content */
    .content { flex: 1; padding: 1.5rem; overflow-y: auto; }
    .content h1 { font-size: 1.4rem; margin-bottom: 1rem; }

    /* Task List */
    .task-list {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      max-width: 700px;
      margin: 0 auto;
    }

    .task {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      background: var(--card);
      padding: 0.9rem 1rem;
      border-radius: 8px;
      border: 1px solid #eee;
      transition: box-shadow 0.2s;
    }

    .task:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }

    .task .left {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      flex: 1;
      min-width: 0;
    }

    .task-title {
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 400px;
    }

    .task-desc {
      font-size: 0.85rem;
      color: var(--light);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 400px;
    }

    .task-meta {
      font-size: 0.8rem;
      color: var(--light);
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .task.completed .task-title { text-decoration: line-through; opacity: 0.7; }
    .task.completed .task-desc { text-decoration: line-through; opacity: 0.6; }

    .task .actions {
      display: flex;
      gap: 0.5rem;
    }

    .task .actions button {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1rem;
    }
    .task .actions button.done { color: #2ecc71; }
    .task .actions button.delete { color: #e74c3c; }
  </style>
</head>
<body>

  <!-- Navbar -->
  <%- include("navbar", { username }) %>

  <!-- Layout -->
  <div class="layout">
    <% if(username !== "guest") { %>
      <!-- Sidebar -->
      <%- include("sidebar") %>
    <% } %>

    <!-- Content -->
    <main class="content">
      <h1><%= username === "guest" ? "Welcome, Guest" : "Your Tasks" %></h1>

      <% if(username !== "guest") { %>
        <!-- Task List -->
        <div class="task-list">
          <% if(todos.length === 0) { %>
            <p>No tasks yet! üéâ Use ‚ûï Add Task button in the sidebar.</p>
          <% } else { %>
            <% todos.forEach(todo => { %>
              <div class="task <%= todo.completed ? 'completed' : '' %>">
                <div class="left">
                  <div class="task-title"><%= todo.text %></div>
                  <% if(todo.description) { %>
                    <div class="task-desc"><%= todo.description %></div>
                  <% } %>
                  <div class="task-meta">
                    <% if(todo.priority) { %>
                      <span>üö© <%= todo.priority %></span>
                    <% } %>
                    <% if(todo.deadline) { %>
                      <span>üìÖ <%= todo.deadline %></span>
                    <% } %>
                    <% if(todo.reminder) { %>
                      <span>‚è∞ <%= todo.reminder %></span>
                    <% } else if(todo.reminderOffset && todo.deadline) { %>
                      <span>‚è∞ <%= todo.reminderOffset %> min before</span>
                    <% } %>
                  </div>
                </div>

                <div class="actions">
                  <form action="/home/toggle" method="POST" style="display:inline;">
                    <input type="hidden" name="taskId" value="<%= todo.id %>">
                    <input type="hidden" name="username" value="<%= username %>">
                    <button type="submit" class="done"><%= todo.completed ? 'Undo' : '‚úîÔ∏è' %></button>
                  </form>
                  <form action="/home/delete" method="POST" style="display:inline;">
                    <input type="hidden" name="taskId" value="<%= todo.id %>">
                    <input type="hidden" name="username" value="<%= username %>">
                    <button type="submit" class="delete">üóëÔ∏è</button>
                  </form>
                  <button 
                    type="button" 
                    class="edit-btn" 
                    data-id="<%= todo.id %>" 
                    data-text="<%= todo.text %>" 
                    data-description="<%= todo.description || '' %>" 
                    data-priority="<%= todo.priority || 'Medium' %>" 
                    data-deadline="<%= todo.deadline || '' %>" 
                    data-reminder="<%= todo.reminder || '' %>" 
                    data-reminderoffset="<%= todo.reminderOffset || '0' %>"
                  >‚úèÔ∏è</button>
                </div>
              </div>
            <% }) %>
          <% } %>
        </div>
      <% } %>
    </main>
  </div>

  <!-- Footer -->
  <%- include("footer") %>
</body>
</html>
